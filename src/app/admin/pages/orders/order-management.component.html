<!-- Header Section -->
<div class="page-header">
  <div class="header-content">
    <div>
      <h1 class="page-title">Gestión de Pedidos</h1>
      <p class="page-subtitle">Administra y da seguimiento a todos los pedidos</p>
    </div>
    <div class="header-actions">
      <button (click)="refreshOrders()" class="btn-secondary">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Actualizar
      </button>
      <button (click)="exportOrders()" class="btn-primary">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Exportar
      </button>
    </div>
  </div>
</div>

<!-- Filters Section -->
<div class="filters-section">
  <div class="search-box">
    <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (ngModelChange)="applyFilters()"
      placeholder="Buscar por cliente, email o ID de pedido..."
      class="search-input"
    />
  </div>

  <div class="filter-group">
    <label class="filter-label">Estado:</label>
    <select [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()" class="filter-select">
      <option value="all">Todos</option>
      <option value="pending">Pendientes</option>
      <option value="processing">Procesando</option>
      <option value="delivered">Entregados</option>
      <option value="cancelled">Cancelados</option>
    </select>
  </div>

  <div class="results-count">
    Mostrando {{ paginatedOrders.length }} de {{ filteredOrders.length }} pedidos
  </div>
</div>

<!-- Orders Table -->
<div class="table-container">
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <table class="orders-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Cliente</th>
        <th>Email</th>
        <th>Items</th>
        <th>Total</th>
        <th>Estado</th>
        <th>Fecha</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of paginatedOrders" class="table-row">
        <td class="order-id">#{{ order.id }}</td>
        <td class="customer-name">{{ order.customerName }}</td>
        <td class="customer-email">{{ order.customerEmail }}</td>
        <td class="items-count">{{ order.items }}</td>
        <td class="order-amount">{{ formatCurrency(order.amount) }}</td>
        <td>
          <span [class]="'status-badge ' + getStatusClass(order.status)">
            {{ getStatusLabel(order.status) }}
          </span>
        </td>
        <td class="order-date">{{ formatDate(order.createdAt) }}</td>
        <td class="actions-cell">
          <button (click)="viewOrderDetails(order.id)" class="action-btn view-btn" title="Ver detalles">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
          </button>
          <button (click)="openStatusModal(order)" class="action-btn edit-btn" title="Cambiar estado">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
          </button>
        </td>
      </tr>

      <tr *ngIf="paginatedOrders.length === 0" class="empty-row">
        <td colspan="8" class="empty-message">
          <div class="empty-state">
            <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
            </svg>
            <p>No se encontraron pedidos</p>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="pagination" *ngIf="filteredOrders.length > 0">
  <button
    (click)="previousPage()"
    [disabled]="currentPage === 1"
    class="pagination-btn"
  >
    Anterior
  </button>

  <div class="page-numbers">
    <button
      *ngFor="let page of pageNumbers"
      (click)="goToPage(page)"
      [class.active]="currentPage === page"
      class="page-number"
    >
      {{ page }}
    </button>
  </div>

  <button
    (click)="nextPage()"
    [disabled]="currentPage === totalPages"
    class="pagination-btn"
  >
    Siguiente
  </button>
</div>

<!-- Order Detail Modal -->
<div *ngIf="showDetailModal" class="modal-overlay" (click)="closeDetailModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalles del Pedido #{{ selectedOrder?.id }}</h2>
      <button (click)="closeDetailModal()" class="close-btn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="modal-body" *ngIf="selectedOrder">
      <!-- Status Badge -->
      <div class="detail-section">
        <span [class]="'status-badge large ' + getStatusClass(selectedOrder.status)">
          {{ getStatusLabel(selectedOrder.status) }}
        </span>
      </div>

      <!-- Customer Info -->
      <div class="detail-section">
        <h3 class="section-title">Información del Cliente</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Nombre:</span>
            <span class="info-value">{{ selectedOrder.customer.name }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Email:</span>
            <span class="info-value">{{ selectedOrder.customer.email }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Teléfono:</span>
            <span class="info-value">{{ selectedOrder.customer.phone }}</span>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="detail-section">
        <h3 class="section-title">Dirección de Envío</h3>
        <div class="address-box">
          <p>{{ selectedOrder.shippingAddress.street }}</p>
          <p>{{ selectedOrder.shippingAddress.city }}, {{ selectedOrder.shippingAddress.state }}</p>
          <p>{{ selectedOrder.shippingAddress.zipCode }}</p>
          <p>{{ selectedOrder.shippingAddress.country }}</p>
        </div>
      </div>

      <!-- Order Items -->
      <div class="detail-section">
        <h3 class="section-title">Productos</h3>
        <div class="products-list">
          <div *ngFor="let item of selectedOrder.orderItems" class="product-item">
            <img [src]="item.imageUrl" [alt]="item.name" class="product-image">
            <div class="product-info">
              <p class="product-name">{{ item.name }}</p>
              <p class="product-details">Cantidad: {{ item.quantity }} × {{ formatCurrency(item.price) }}</p>
            </div>
            <div class="product-total">
              {{ formatCurrency(item.subtotal) }}
            </div>
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="detail-section">
        <h3 class="section-title">Resumen del Pedido</h3>
        <div class="summary-box">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span>{{ formatCurrency(selectedOrder.subtotal) }}</span>
          </div>
          <div class="summary-row">
            <span>Envío:</span>
            <span>{{ formatCurrency(selectedOrder.shipping) }}</span>
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span>{{ formatCurrency(selectedOrder.total) }}</span>
          </div>
        </div>
      </div>

      <!-- Payment Method -->
      <div class="detail-section">
        <div class="info-item">
          <span class="info-label">Método de Pago:</span>
          <span class="info-value">{{ selectedOrder.paymentMethod }}</span>
        </div>
      </div>

      <!-- Status History -->
      <div class="detail-section">
        <h3 class="section-title">Historial de Estados</h3>
        <div class="timeline">
          <div *ngFor="let history of selectedOrder.statusHistory" class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
              <p class="timeline-status">{{ getStatusLabel(history.status) }}</p>
              <p class="timeline-date">{{ formatDate(history.timestamp) }}</p>
              <p class="timeline-note" *ngIf="history.note">{{ history.note }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button (click)="openStatusModal(selectedOrder!)" class="btn-primary">
        Cambiar Estado
      </button>
      <button (click)="closeDetailModal()" class="btn-secondary">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Status Update Modal -->
<div *ngIf="showStatusModal" class="modal-overlay" (click)="closeStatusModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Actualizar Estado del Pedido</h2>
      <button (click)="closeStatusModal()" class="close-btn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Nuevo Estado</label>
        <select [(ngModel)]="newStatus" class="form-select">
          <option value="pending">Pendiente</option>
          <option value="processing">Procesando</option>
          <option value="delivered">Entregado</option>
          <option value="cancelled">Cancelado</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Nota (Opcional)</label>
        <textarea
          [(ngModel)]="statusNote"
          class="form-textarea"
          rows="3"
          placeholder="Agrega una nota sobre el cambio de estado..."
        ></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button (click)="updateOrderStatus()" class="btn-primary" [disabled]="!newStatus">
        Actualizar Estado
      </button>
      <button (click)="closeStatusModal()" class="btn-secondary">
        Cancelar
      </button>
    </div>
  </div>
</div>

