<!-- Admin Container -->
<div class="admin-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Gestión de Productos</h1>
      <p>Administra el catálogo completo de productos de Bosko</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Nuevo Producto
    </button>
  </div>

  <!-- Stats Summary -->
  <div class="stats-summary" *ngIf="!loading">
    <div class="stat-card">
      <div class="stat-icon blue">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-label">Total Productos</span>
        <span class="stat-value">{{ totalCount }}</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M9 12l2 2 4-4"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-label">En Stock</span>
        <span class="stat-value">{{ getInStockCount() }}</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-label">Categorías</span>
        <span class="stat-value">{{ categories.length }}</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </svg>
      </div>
      <div class="stat-content">
        <span class="stat-label">Valor Inventario</span>
        <span class="stat-value">${{ getTotalValue() }}</span>
      </div>
    </div>
  </div>

  <!-- Filters Card -->
  <div class="filters-card">
    <div class="filters-header">
      <h3>Filtros de Búsqueda</h3>
      <button class="btn-clear-filters" (click)="clearFilters()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
        </svg>
        Limpiar
      </button>
    </div>

    <div class="filters-grid">
      <!-- Search -->
      <div class="filter-group">
        <label>Buscar Producto</label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="applyFilters()"
          placeholder="Nombre o descripción..." />
      </div>

      <!-- Category -->
      <div class="filter-group">
        <label>Categoría</label>
        <select [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option [value]="undefined">Todas las categorías</option>
          <option *ngFor="let cat of categories" [value]="cat.id">
            {{ cat.name }} ({{ cat.productCount }})
          </option>
        </select>
      </div>

      <!-- Stock -->
      <div class="filter-group">
        <label>Disponibilidad</label>
        <select [(ngModel)]="stockFilter" (change)="applyFilters()">
          <option [value]="undefined">Todos los productos</option>
          <option [value]="true">En stock</option>
          <option [value]="false">Sin stock</option>
        </select>
      </div>

      <!-- Sort -->
      <div class="filter-group">
        <label>Ordenar por</label>
        <select [(ngModel)]="sortBy" (change)="applyFilters()">
          <option value="CreatedAt">Fecha de creación</option>
          <option value="Name">Nombre (A-Z)</option>
          <option value="Price">Precio</option>
          <option value="Stock">Stock disponible</option>
        </select>
      </div>

      <!-- Min Price -->
      <div class="filter-group">
        <label>Precio Mínimo</label>
        <input
          type="number"
          [(ngModel)]="minPrice"
          (change)="applyFilters()"
          placeholder="$ 0.00"
          min="0"
          step="0.01" />
      </div>

      <!-- Max Price -->
      <div class="filter-group">
        <label>Precio Máximo</label>
        <input
          type="number"
          [(ngModel)]="maxPrice"
          (change)="applyFilters()"
          placeholder="$ 999,999.99"
          min="0"
          step="0.01" />
      </div>
    </div>

    <div class="filters-actions">
      <button class="btn-apply" (click)="applyFilters()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 6h18M7 12h10m-7 6h4"/>
        </svg>
        Aplicar Filtros
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <span>{{ error }}</span>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- Products Table -->
  <div class="table-card" *ngIf="!loading && products.length > 0">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categoría</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Estado</th>
            <th>Fecha</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products">
            <!-- Product Info -->
            <td>
              <div class="product-info">
                <div class="product-image">
                  <img *ngIf="product.image" [src]="product.image" [alt]="product.name" />
                  <div *ngIf="!product.image" class="product-placeholder">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <circle cx="8.5" cy="8.5" r="1.5"></circle>
                      <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                  </div>
                </div>
                <div class="product-details">
                  <h4>{{ product.name }}</h4>
                  <p>{{ product.description || 'Sin descripción' }}</p>
                </div>
              </div>
            </td>

            <!-- Category -->
            <td>
              <span class="badge category-badge">
                {{ product.categoryName || 'Sin categoría' }}
              </span>
            </td>

            <!-- Price -->
            <td>
              <span class="product-price">${{ product.price.toFixed(2) }}</span>
            </td>

            <!-- Stock -->
            <td>
              <div class="stock-info">
                <span class="stock-value">{{ product.stock }}</span>
                <span class="stock-label">unidades</span>
              </div>
            </td>

            <!-- Status -->
            <td>
              <span class="badge" [class.in-stock]="product.stock > 0" [class.out-stock]="product.stock === 0">
                {{ product.stock > 0 ? 'Disponible' : 'Agotado' }}
              </span>
            </td>

            <!-- Date -->
            <td>
              <span class="product-date">{{ formatDate(product.createdAt) }}</span>
            </td>

            <!-- Actions -->
            <td class="text-right">
              <div class="actions">
                <button class="btn-action edit" (click)="openEditModal(product)" title="Editar producto">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="btn-action delete" (click)="deleteProduct(product)" title="Eliminar producto">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * pageSize + 1 }} - {{ Math.min(currentPage * pageSize, totalCount) }} de {{ totalCount }} productos
      </div>
      <div class="pagination-controls">
        <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
          Anterior
        </button>
        <span class="page-number">Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
          Siguiente
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && products.length === 0">
    <div class="empty-icon">
      <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
      </svg>
    </div>
    <h3>No se encontraron productos</h3>
    <p>No hay productos que coincidan con los filtros aplicados, o aún no has creado ningún producto</p>
    <button class="btn-primary" (click)="openCreateModal()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Crear Primer Producto
    </button>
  </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal modal-large" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <h2>{{ modalMode === 'create' ? 'Nuevo Producto' : 'Editar Producto' }}</h2>
      </div>
      <button class="modal-close" (click)="closeModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group full-width">
          <label>
            Nombre del Producto *
            <span class="label-hint">Un nombre descriptivo y único para el producto</span>
          </label>
          <input
            type="text"
            [(ngModel)]="productForm.name"
            placeholder="Ej: Camiseta Premium Bosko, Pantalón Deportivo..."
            maxlength="100"
            [class.error]="!productForm.name && formTouched" />
          <span class="char-count">{{ productForm.name.length }}/100</span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label>
            Descripción
            <span class="label-hint">Describe las características principales del producto</span>
          </label>
          <textarea
            [(ngModel)]="productForm.description"
            placeholder="Describe las características, materiales, tallas disponibles, cuidados..."
            rows="4"
            maxlength="500"></textarea>
          <span class="char-count">{{ productForm.description?.length || 0 }}/500</span>
        </div>
      </div>

      <div class="form-row two-columns">
        <div class="form-group">
          <label>
            Precio *
            <span class="label-hint">Precio en dólares</span>
          </label>
          <div class="input-with-icon">
            <span class="input-icon">$</span>
            <input
              type="number"
              [(ngModel)]="productForm.price"
              placeholder="0.00"
              min="0"
              step="0.01"
              [class.error]="(!productForm.price || productForm.price <= 0) && formTouched" />
          </div>
        </div>

        <div class="form-group">
          <label>
            Stock Inicial *
            <span class="label-hint">Cantidad disponible</span>
          </label>
          <input
            type="number"
            [(ngModel)]="productForm.stock"
            placeholder="0"
            min="0"
            [class.error]="productForm.stock === undefined && formTouched" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label>
            Categoría
            <span class="label-hint">Asigna el producto a una categoría</span>
          </label>
          <select [(ngModel)]="productForm.categoryId">
            <option [value]="undefined">Sin categoría</option>
            <option *ngFor="let cat of categories" [value]="cat.id">
              {{ cat.name }} ({{ cat.productCount }} productos)
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group full-width">
          <label>
            URL de la Imagen
            <span class="label-hint">Imagen del producto (recomendado 800x800px)</span>
          </label>
          <input
            type="url"
            [(ngModel)]="productForm.image"
            placeholder="https://ejemplo.com/imagen-producto.jpg" />
        </div>
      </div>

      <!-- Image Preview -->
      <div class="image-preview" *ngIf="productForm.image">
        <label>Vista Previa</label>
        <div class="preview-container">
          <img [src]="productForm.image" [alt]="productForm.name" (error)="onImageError()" />
          <button class="btn-remove-image" (click)="productForm.image = ''" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeModal()" [disabled]="loading">
        Cancelar
      </button>
      <button class="btn-save" (click)="saveProduct()" [disabled]="loading || !productForm.name || !productForm.price">
        <svg *ngIf="loading" class="spinner-small" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
        </svg>
        <svg *ngIf="!loading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        {{ modalMode === 'create' ? 'Crear Producto' : 'Guardar Cambios' }}
      </button>
    </div>
  </div>
</div>
